<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Gulab Ornament X Madhuri Jewellers</title>
    
    <!-- PWA Meta -->
    <meta name="theme-color" content="#B8860B" />
    <meta name="description" content="Live gold and silver rates for Gulab Ornament X Madhuri Jewellers" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- React & Babel (UMD) -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin="anonymous"></script>

    <!-- Tailwind Config (Must be before Tailwind CDN) -->
    <script>
      tailwind = {
        config: {
          theme: {
            extend: {
              colors: {
                gold: {
                  50: '#FBF8F1',
                  100: '#F5EEDA',
                  200: '#EBDDB0',
                  300: '#E0CA82',
                  400: '#D6B658',
                  500: '#CC9F2E', // Base Gold
                  600: '#A37A1E',
                  700: '#8A6615', // Darker for text
                  800: '#6B4F10',
                  900: '#423006', // Very dark for headings
                }
              }
            }
          }
        }
      }
    </script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js" crossorigin="anonymous"></script>

    <style>
      :root {
        --font-heading: 'Playfair Display', serif;
        --font-body: 'Inter', sans-serif;
      }
      body {
        font-family: var(--font-body);
        background-color: #FDFBF7;
        color: #4A4A4A;
      }
      h1, h2, h3, h4, h5, h6 {
        font-family: var(--font-heading);
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 4px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #CC9F2E;
        border-radius: 2px;
      }
      .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }
      @keyframes shimmer {
        0% {
          background-position: -200% center;
        }
        100% {
          background-position: 200% center;
        }
      }
      .gold-text-shimmer {
        background: linear-gradient(
          to right,
          #423006 0%,
          #423006 40%,
          #D4AF37 50%,
          #423006 60%,
          #423006 100%
        );
        background-size: 200% auto;
        color: #423006;
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: shimmer 3s linear infinite;
      }
    </style>
  </head>
  <body class="antialiased h-[100dvh] flex flex-col overflow-hidden selection:bg-gold-200 selection:text-gold-900">
    <div id="root" class="h-full w-full flex flex-col"></div>

    <script type="text/babel">
      const { useState, useEffect, Component } = React;

      // --- Error Boundary ---
      class ErrorBoundary extends Component {
        constructor(props) {
          super(props);
          this.state = { hasError: false, error: null };
        }

        static getDerivedStateFromError(error) {
          return { hasError: true, error };
        }

        componentDidCatch(error, errorInfo) {
          console.error("Uncaught error:", error, errorInfo);
        }

        render() {
          if (this.state.hasError) {
            return (
              <div className="flex items-center justify-center h-full p-6 text-center text-red-600 bg-red-50">
                <div>
                  <h2 className="text-lg font-bold mb-2">Something went wrong</h2>
                  <p className="text-sm opacity-80">{this.state.error?.message || "Unknown error"}</p>
                  <button onClick={() => window.location.reload()} className="mt-4 px-4 py-2 bg-red-600 text-white rounded shadow">
                    Reload Application
                  </button>
                </div>
              </div>
            );
          }
          return this.props.children;
        }
      }

      // --- Firebase Initialization ---
      const firebaseConfig = {
        apiKey: "AIzaSyCn654g92JIMmYkLZ2bGuJu9rv3D2UHnYo",
        authDomain: "gulab-jewellers.firebaseapp.com",
        projectId: "gulab-jewellers",
        storageBucket: "gulab-jewellers.firebasestorage.app",
        messagingSenderId: "179811621534",
        appId: "1:179811621534:web:da5e6ca69a60a6be31b98f",
        measurementId: "G-0CZB78MM3X"
      };

      let db = null;
      try {
        if (typeof firebase !== 'undefined') {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
        }
      } catch (err) {
        console.error("Firebase Init Error:", err);
      }

      // --- Components ---

      const ShareIcon = (props) => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" {...props}>
          <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.875-1.977l-4.94-2.47a3.027 3.027 0 000-.742l4.94-2.47A3 3 0 0015 8z" />
        </svg>
      );

      const PhoneIcon = (props) => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" {...props}>
          <path fillRule="evenodd" d="M2 3.5A1.5 1.5 0 013.5 2h1.148a1.5 1.5 0 011.465 1.175l.716 3.223a1.5 1.5 0 01-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 006.254 6.254c.395.117.833-.07.95-.48l.267-.933a1.5 1.5 0 011.767-1.052l3.223.716A1.5 1.5 0 0118 15.352V16.5a1.5 1.5 0 01-1.5 1.5H15c-1.149 0-2.263-.15-3.326-.43A13.022 13.022 0 012.43 8.326 13.019 13.019 0 012 5V3.5z" clipRule="evenodd" />
        </svg>
      );

      const DiamondIcon = (props) => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" {...props}>
           <path d="M12,2L2,12L12,22L22,12L12,2Z" />
        </svg>
      );

      // Section Headers
      const GoldBarIcon = (props) => (
        <svg fill="currentColor" viewBox="0 0 20 20" {...props}>
          <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a1 1 0 100-2 1 1 0 000 2z" />
        </svg>
      );

      const SilverBarIcon = (props) => (
        <svg fill="currentColor" viewBox="0 0 20 20" {...props}>
           <path fillRule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clipRule="evenodd" />
        </svg>
      );

      const SectionHeader = ({ title, icon: Icon, colorClass }) => (
         <div className="flex items-center gap-4 mb-5">
            <div className="h-px flex-1 bg-gradient-to-r from-transparent to-gray-200"></div>
            <div className={`flex items-center gap-2 px-4 py-1.5 rounded-full border shadow-sm bg-white ${colorClass}`}>
                <Icon className="w-4 h-4" />
                <h3 className="text-xs font-bold uppercase tracking-[0.2em]">{title}</h3>
            </div>
            <div className="h-px flex-1 bg-gradient-to-l from-transparent to-gray-200"></div>
         </div>
      );

      const RateCard = ({ label, purity, rate, loading, isSilver }) => {
        const containerClasses = isSilver 
          ? "bg-gradient-to-br from-white to-slate-50 border-slate-200 text-slate-800"
          : "bg-gradient-to-br from-white to-gold-50 border-gold-200 text-gold-900";

        const labelColor = isSilver ? "text-slate-600" : "text-gold-800";
        const badgeClasses = isSilver 
          ? "bg-slate-100 text-slate-600 border border-slate-200" 
          : "bg-white/80 text-gold-700 border border-gold-100";
        
        // Simple text color, no gradient
        const priceColor = isSilver ? "text-slate-700" : "text-gold-700";

        return (
          <div className={`relative w-full p-5 rounded-2xl border shadow-[0_2px_10px_-4px_rgba(0,0,0,0.05)] transition-all ${containerClasses}`}>
             <div className="flex items-center justify-between">
                <div className="flex flex-col gap-1.5">
                    <span className={`text-sm font-bold tracking-wide ${labelColor}`}>{label}</span>
                    <span className={`text-[10px] w-fit px-2 py-0.5 rounded shadow-sm font-semibold uppercase tracking-wider ${badgeClasses}`}>{purity}</span>
                </div>
                
                {loading ? (
                    <div className="h-9 w-28 rounded-lg animate-pulse bg-gray-200/60"></div>
                ) : (
                    <div className="flex items-baseline gap-1">
                         <span className={`text-sm font-medium opacity-60 ${isSilver ? 'text-slate-500' : 'text-gold-600'}`}>‚Çπ</span>
                         {/* Removed custom font family to keep it simple */}
                         <span className={`text-2xl sm:text-3xl font-bold tracking-tight ${priceColor}`}>
                            {rate !== undefined && rate !== null ? rate.toLocaleString('en-IN') : '--'}
                         </span>
                    </div>
                )}
             </div>
          </div>
        );
      };

      const ContactCard = ({ name, role, number }) => (
        <div className="flex items-center justify-between p-4 bg-white rounded-xl border border-gold-100 shadow-sm w-full group transition-all hover:border-gold-300">
          <div className="flex flex-col">
            <span className="font-bold text-gold-900 text-sm group-hover:text-gold-700 transition-colors">{name}</span>
            {role && <span className="text-[10px] text-gold-500 font-medium uppercase tracking-wide mt-0.5">{role}</span>}
          </div>
          <a href={`tel:${number}`} className="flex items-center gap-2 text-gold-700 font-mono text-xs font-bold hover:bg-gold-50 transition-colors bg-white px-3 py-2 rounded-lg border border-gold-100 shadow-sm">
            <PhoneIcon className="w-3.5 h-3.5" />
            <span>{number}</span>
          </a>
        </div>
      );

      // --- Main App ---

      const GOLD_ITEMS = [
        { key: 'gold_bar_9950', label: 'Gold Bar', purity: '99.50%', },
        { key: 'gold_bar_9999', label: 'Gold Bar', purity: '99.99%', },
        { key: 'gold_rtgs_9999', label: 'Gold RTGS', purity: '99.99%' },
      ];

      const SILVER_ITEMS = [
        { key: 'silver_batiya', label: 'Silver Batiya', purity: 'Standard', isSilver: true },
        { key: 'silver_rtgs_batiya', label: 'Silver RTGS', purity: 'Batiya', isSilver: true },
      ];

      const App = () => {
        const [rates, setRates] = useState(null);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);

        useEffect(() => {
          try {
            const savedRates = localStorage.getItem("metalRates");
            if (savedRates) {
              setRates(JSON.parse(savedRates));
              setLoading(false);
            }
          } catch (e) {
            console.error("Failed to parse saved rates", e);
          }

          if (!db) {
            setError("Database connection unavailable.");
            setLoading(false);
            return;
          }

          // Use Firestore listener
          let unsubscribe = () => {};
          try {
              unsubscribe = db.collection("rates").doc("today")
                .onSnapshot((doc) => {
                  if (doc.exists) {
                    const val = doc.data();
                    const newRates = {
                      gold_bar_9950: Number(val.gold_bar_9950) || 0,
                      gold_bar_9999: Number(val.gold_bar_9999) || 0,
                      gold_rtgs_9999: Number(val.gold_rtgs_9999) || 0,
                      silver_batiya: Number(val.silver_batiya) || 0,
                      silver_rtgs_batiya: Number(val.silver_rtgs_batiya) || 0
                    };
                    setRates(newRates);
                    try {
                        localStorage.setItem("metalRates", JSON.stringify(newRates));
                    } catch (storageErr) {
                        console.warn("LocalStorage access failed", storageErr);
                    }
                    setLoading(false);
                    setError(null);
                  } else {
                    setLoading(false);
                  }
                }, (err) => {
                  console.error("Firestore read failed:", err);
                  setError("Live updates temporarily unavailable.");
                  setLoading(false);
                });
          } catch (err) {
              console.error("Firestore subscription failed", err);
              setError("Connection failed.");
              setLoading(false);
          }

          return () => {
             if (typeof unsubscribe === 'function') unsubscribe();
          };
        }, []);

        const handleShare = async () => {
          if (navigator.share && rates) {
            const shareText = `‚ú® Gulab Ornament X Madhuri Jewellers ‚ú®\n\nüì¢ Today's Live Rates:\n\nüü° GOLD\n‚Ä¢ Gold Bar (99.50%): ‚Çπ${rates.gold_bar_9950}\n‚Ä¢ Gold Bar (99.99%): ‚Çπ${rates.gold_bar_9999}\n‚Ä¢ Gold RTGS (99.99%): ‚Çπ${rates.gold_rtgs_9999}\n\n‚ö™ SILVER\n‚Ä¢ Silver Batiya: ‚Çπ${rates.silver_batiya}\n‚Ä¢ Silver RTGS: ‚Çπ${rates.silver_rtgs_batiya}\n\nThank you for your business! üôè\nVisit us for the finest jewellery and purity you can trust.\n\nüìû Contact: 9335660331`;
            try {
              await navigator.share({
                title: 'Live Rates - Gulab Ornament X Madhuri Jewellers',
                text: shareText,
              });
            } catch (err) {
              console.error("Error sharing:", err);
            }
          } else {
            alert('Share functionality is not supported on this browser.');
          }
        };

        return (
          <div className="flex flex-col flex-grow w-full max-w-lg mx-auto h-full shadow-2xl bg-[#FFFDF8]" style={{ fontFamily: 'var(--font-body)' }}>
            {/* Header - Sticky */}
            <header className="px-4 py-3 glass-effect z-50 border-b border-gold-100 shadow-sm sticky top-0">
              <div className="flex flex-col items-center justify-center">
                
                {/* Brand Area */}
                <div className="flex flex-col items-center gap-0.5 mb-1">
                   <h1 className="text-center flex flex-col items-center leading-tight">
                     <span className="text-3xl sm:text-4xl font-bold gold-text-shimmer drop-shadow-sm pb-0.5" style={{ fontFamily: 'var(--font-heading)' }}>
                       Gulab Ornament
                     </span>
                     <div className="flex items-center gap-2 w-full justify-center my-0.5 opacity-80">
                         <div className="h-px bg-gold-300 w-6"></div>
                         <span className="text-[9px] text-gold-600 uppercase tracking-widest font-medium">collaborating with</span>
                         <div className="h-px bg-gold-300 w-6"></div>
                     </div>
                     <span className="text-2xl sm:text-3xl font-semibold gold-text-shimmer" style={{ fontFamily: 'var(--font-heading)' }}>
                       Madhuri Jewellers
                     </span>
                   </h1>
                </div>

                {/* Tagline */}
                <div className="mt-0.5">
                   <p className="text-[10px] uppercase tracking-[0.3em] text-gold-500 font-semibold text-center">Excellence in Purity</p>
                </div>

              </div>
            </header>

            {/* Main Content - Scrollable */}
            <main className="flex-grow flex flex-col px-5 py-6 gap-8 overflow-y-auto pb-12 bg-gradient-to-b from-transparent to-gold-50/30">
              
              {/* Controls */}
              <div className="flex justify-between items-center px-1">
                 <div className="flex items-center gap-2 bg-emerald-50 px-3 py-1.5 rounded-full border border-emerald-100/60 shadow-sm">
                    <span className="relative flex h-2 w-2">
                      <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                      <span className="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                    </span>
                    <span className="text-[10px] font-bold text-emerald-700 uppercase tracking-wide">Live Market</span>
                 </div>
                 <button 
                    onClick={handleShare} 
                    className="py-1.5 px-3.5 rounded-full bg-white hover:bg-gold-50 text-gold-800 transition-colors flex items-center gap-2 border border-gold-200 shadow-sm group"
                    aria-label="Share Rates"
                  >
                    <ShareIcon className="w-3.5 h-3.5 text-gold-500 group-hover:text-gold-700" />
                    <span className="text-[11px] font-bold">Share</span>
                  </button>
              </div>
              
              {/* Error Message Only */}
              {error && <p className="text-red-500 text-xs text-center py-2 bg-red-50 rounded-lg border border-red-100">{error}</p>}
              
              {/* Gold Section */}
              <section>
                 <SectionHeader 
                    title="Gold Rates" 
                    icon={GoldBarIcon} 
                    colorClass="border-gold-200 text-gold-800"
                 />
                 <div className="flex flex-col gap-4">
                    {GOLD_ITEMS.map((item) => (
                       <div key={item.key}>
                          <RateCard 
                             label={item.label}
                             purity={item.purity}
                             rate={rates ? rates[item.key] : undefined}
                             loading={loading && !rates}
                          />
                       </div>
                    ))}
                 </div>
              </section>

              {/* Silver Section */}
              <section>
                 <SectionHeader 
                    title="Silver Rates" 
                    icon={SilverBarIcon} 
                    colorClass="border-slate-200 text-slate-700"
                 />
                 <div className="flex flex-col gap-4">
                    {SILVER_ITEMS.map((item) => (
                       <div key={item.key}>
                          <RateCard 
                             label={item.label}
                             purity={item.purity}
                             rate={rates ? rates[item.key] : undefined}
                             loading={loading && !rates}
                             isSilver={true}
                          />
                       </div>
                    ))}
                 </div>
              </section>

              {/* Contacts Section */}
              <div className="mt-4">
                <div className="flex items-center gap-4 mb-6 opacity-60">
                    <div className="h-px bg-gold-300 flex-grow"></div>
                    <div className="p-1.5 rounded-full border border-gold-200 bg-gold-50">
                        <DiamondIcon className="w-3 h-3 text-gold-500" />
                    </div>
                    <div className="h-px bg-gold-300 flex-grow"></div>
                </div>
                <div className="flex flex-col gap-3">
                  <ContactCard name="Gulab Ji" role="Proprietor" number="9335660331" />
                  <ContactCard name="Vikas Verma" number="7499233028" />
                  <ContactCard name="Nishant Verma" number="7619996888" />
                </div>
              </div>

            </main>

            {/* Footer */}
            <footer className="bg-white text-gold-900/40 py-6 text-center shrink-0 border-t border-gold-100">
              <p className="text-[10px] font-semibold tracking-widest uppercase">
                &copy; 2024 Gulab Ornament X Madhuri Jewellers
              </p>
            </footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(
        <ErrorBoundary>
            <App />
        </ErrorBoundary>
      );
    </script>
  </body>
</html>
